<?php 
use Symfony\Component\HttpFoundation\Response;




$app->match('/', function() use ($app) {
    return new Response ('Yeah !');
})->bind('kp_homepage');

function generate_image($size){
   $file = $size.".png";
	
   // $path = __DIR__.'/../web/'.$file;
   $path = $file;
   
   $expl = explode ('x', $size);
   // print_r($expl);
   if (count ($expl) == 2 && !empty ($expl[0]) && !empty ($expl[1])){
      $image = imagecreate(100, 20);
      $red_background = imagecolorallocate($image, 255, 0, 0);
      $black = imagecolorallocate($image, 0, 0, 0);

      imagestring($image, 4, 10, 2,' hyve test', $black);

      // imagepng($image);
      imagepng ( $image, $path );
      $result = $path;
      echo $path;
   }
   else
      $result = null;

   return $result;
}

$app->match('/img/{size}/', function($size) use ($app) {
   // return new Response ('Oh...!');
   $expl = explode ('x', $size);
   /*
   $file = "image.png";
   $path = __DIR__.'/../web/'.$file;*/

   generate_image($size);

   if ($path == null) {
      return new Response ('Erreur !');
   }

   $stream = readfile($path);

   return new Response($stream, 200, array('Content-Type' => 'image/png'));

   return new Response ('Yop !');
})->bind('kp_img');
